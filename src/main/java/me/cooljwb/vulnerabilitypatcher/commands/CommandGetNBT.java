package me.cooljwb.vulnerabilitypatcher.commands;

import me.cooljwb.vulnerabilitypatcher.SMG;
import me.cooljwb.vulnerabilitypatcher.VulnerabilityPatcher;
import me.cooljwb.vulnerabilitypatcher.patches.Patches;
import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.Material;
import org.bukkit.command.Command;
import org.bukkit.command.CommandExecutor;
import org.bukkit.command.CommandSender;
import org.bukkit.entity.Player;
import org.bukkit.inventory.ItemStack;

public class CommandGetNBT extends Patches implements CommandExecutor {

    public static String getnbt = "getnbt";

    @Override
    public boolean onCommand(CommandSender sender, Command cmd, String label, String[] args) {
        if(cmd.getName().equalsIgnoreCase(getnbt)) {
            if(!(sender instanceof Player)) {
                msg(sender, SMG.NOT_PLAYER.msg);
                return true;
            }

            Player player = Bukkit.getPlayer(((Player) sender).getUniqueId());
            ItemStack item = player.getInventory().getItemInMainHand();
            String strItem = itemToString(item);

            if(item != null && item.getType() != Material.AIR && strItem != null && !(strItem.length() > 5000))
                msg(sender, SMG.VULNERABILITYPATCHER.msg + ChatColor.GRAY + "Item data: " + ChatColor.GREEN + ChatColor.stripColor(strItem));
            else if(item == null || item.getType() == Material.AIR)
                msg(sender, SMG.GET_ITEM_IN_MAINHAND.msg);
            else if(strItem == null)
                msg(sender, SMG.NO_TAG.msg);
            else if(strItem.length() > 5000)
                msg(sender, SMG.TOO_LARGE_ITEM.msg);
        }
        return true;
    }
}
